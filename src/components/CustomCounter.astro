---

---

<script>
  import { $counter } from "@/stores/couter";
  class CustomCounter extends HTMLElement {
    _count: number;
    unbindListener: any;

    constructor() {
      super();
      this.attachShadow({ mode: "open" });

      this._count = 0;
      this.shadowRoot!.innerHTML = `
          <style>
            button { margin: 0 5px; padding: 5px 10px; }
            span { font-weight: bold; }
          </style>
          <div>
            <button id="decrement">-</button>	
            <span id="value">${this.count}</span>
            <button id="increment">+</button>
          </div>
        `;
      this.increment = this.increment.bind(this);
      this.decrement = this.decrement.bind(this);
    }

    increment() {
      this.count += 1;
    }

    decrement() {
      this.count -= 1;
    }

    get count() {
      return this._count;
    }

    set count(value) {
      this._count = value;

      if (this.shadowRoot) {
        const el: any = this.shadowRoot.querySelector("#value");
        if (el) {
          el.textContent = this.count;
        }
      }

      $counter.set(this.count);

      // Optional: emit a custom event when count changes
      this.dispatchEvent(
        new CustomEvent("count-changed", {
          detail: { count: this._count },
        })
      );
    }

    connectedCallback() {
      this.unbindListener = $counter.subscribe((value: number) => {
        this.count = value;
      });

      if (this.shadowRoot) {
        this.shadowRoot
          .querySelector("#increment")
          ?.addEventListener("click", this.increment);
        this.shadowRoot
          .querySelector("#decrement")
          ?.addEventListener("click", this.decrement);
      }
    }

    disconnectedCallback() {
      if (typeof this.unbindListener == "function") {
        this.unbindListener();
      }

      if (this.shadowRoot) {
        this.shadowRoot
          .querySelector("#increment")
          ?.removeEventListener("click", this.increment);
        this.shadowRoot
          .querySelector("#decrement")
          ?.removeEventListener("click", this.decrement);
      }
    }
  }

  customElements.define("vanila-counter", CustomCounter);
</script>

<vanila-counter></vanila-counter>
